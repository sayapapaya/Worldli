{% extends "app/base.html" %}

{% block script %}
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '926754177344550',
      xfbml      : true,
      version    : 'v2.2'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));


function initialize() {
  var options = {
    sky: true,
    atmosphere: true,
    dragging: true,
    tilting: true,
    zooming: true,
    center: [46.8011, 8.2266],
    zoom: 2
  };
  earth = new WE.map('earth_div', options);
  var natural = WE.tileLayer('http://data.webglearth.com/natural-earth-color/{z}/{x}/{y}.jpg', {
    tileSize: 256,
    tms: true
  });
  natural.addTo(earth);

  var toner = WE.tileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA.',
    opacity: 0.6
  });
  toner.addTo(earth);

{% for problem, images in image_dict.items %}

  var marker1 = WE.marker([{{problem.latitude}},{{problem.longitude}}]).addTo(earth);
  marker1.bindPopup("<h3>{{problem.title}}</h3><span 'style='font-size:8px;color:#999'><img src='{{ images.0.image.url }}' width='100px' height='100px'><br>{{problem.description}}</span>",{maxWidth:150,closeButton:true})
{% endfor %}

var marker = WE.marker([51.5, -0.09]).addTo(earth);
/*
  marker.bindPopup("<h3>Lack of Clean Water</h3><span 'style='font-size:8px;color:#999'><img src='http://www.nofrackingway.us/wp-content/uploads/2012/09/dirty-water.jpeg' width='100px' height='100px'><br>there is rarely an clean water in India. It kinda sucks. People drink their own urine half the time.<br /><h6> by Saya Date </h6></span>", {maxWidth: 150, closeButton: true})//.openPopup();*/
}

$(document).ready(function(){
  initialize();
});

</script>
{% endblock %}


{% block nav %}

{% if user and not user.is_anonymous %}
<ul class="nav navbar-nav navbar-left">
	<li><a href="{% url 'create_post' %}">Post a Problem</a></li>
</ul>
{% endif %}

{% endblock %}


{% block content %}

{% if not user or user.is_anonymous %}
	<div id="social-container">
		<div class="fb-icon-bg"></div>
		<div class="fb-bg" onclick="location.href='{% url 'social:begin' 'facebook' %}?next={{ request.path }}'"></div>
	</div>
{% endif %}

<div id="earth_div"></div>

<ul>
{% for problem in problems %}
	<li><a href="{% url 'view_post' problem.id %}">{{ problem.title }}</a></li>
{% endfor %}
</ul>
{% endblock%}